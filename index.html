<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COTS Architect - Offline Mission Planning</title>
  <link rel="icon" type="image/png" href="assets/LOGO.png">
  <link rel="stylesheet" href="assets/css/styles.css">
  <!-- Leaflet CSS for offline mapping -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
  <!-- Air-gap compliant: No external CDN dependencies -->
  <style>
    /* Hide web-only elements when running in Electron desktop app */
    body.desktop-mode .web-only {
      display: none !important;
    }
  </style>
</head>
<body>
  <header class="top-nav">
    <a href="#/home" class="brand" style="text-decoration: none; color: inherit; cursor: pointer;">
      <img src="assets/LOGO with Text.png" alt="COTS Architect" class="brand-logo" style="height: 36px; width: auto;">
    </a>
    <nav aria-label="Primary">
      <ul class="nav-links">
        <li><a href="#/home" data-route="home">Home</a></li>
        <li><a href="#/library" data-route="library">Parts Library</a></li>
        <li><a href="#/platform" data-route="platform">Platform Designer</a></li>
        <li><a href="#/mission" data-route="mission">Mission Planner</a></li>
        <li><a href="#/comms" data-route="comms">Comms Validator</a></li>
        <li><a href="#/map" data-route="map">üó∫Ô∏è Map & Environment</a></li>
        <li><a href="#/export" data-route="export">Export</a></li>
      </ul>
    </nav>
    <button class="toggle" id="settingsToggle" aria-label="Open settings" title="Settings">‚öôÔ∏è</button>
    <button class="toggle" id="themeToggle" aria-label="Toggle light or dark theme">üåô</button>
  </header>

  <div class="version-strip" aria-label="Application version and status">
    <span class="pill" id="appVersionBadge" data-app-version></span>
    <span class="pill warning web-only" style="background: #ff9800; color: #000;">COTS ARCHITECT ONLINE DEMO - NOT FOR PRODUCTION</span>
    <span class="pill subtle" id="schemaHeaderBadge" data-schema-version></span>
  </div>

  <!-- Workflow Progress Bar -->
  <div class="workflow-progress-container" aria-label="Workflow progress tracker">
    <div class="workflow-progress">
      <div class="progress-step" data-module="library">
        <div class="progress-dot"></div>
        <span class="progress-label">Parts Library</span>
        <span class="progress-status"></span>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-module="platform">
        <div class="progress-dot"></div>
        <span class="progress-label">Platform Designer</span>
        <span class="progress-status"></span>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-module="mission">
        <div class="progress-dot"></div>
        <span class="progress-label">Mission Planner</span>
        <span class="progress-status"></span>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-module="comms">
        <div class="progress-dot"></div>
        <span class="progress-label">Comms Validator</span>
        <span class="progress-status"></span>
      </div>
      <div class="progress-connector"></div>
      <div class="progress-step" data-module="export">
        <div class="progress-dot"></div>
        <span class="progress-label">Export</span>
        <span class="progress-status"></span>
      </div>
    </div>
  </div>

  <div class="context-bar" role="note">
    <p class="small">üîí Offline-first mission planning for air-gapped environments. All data stored locally. Maintained by <a href="https://github.com/nbschultz97" target="_blank" style="color: var(--accent); text-decoration: underline;">Noah Schultz</a>.</p>
  </div>

  <main id="app" class="view-container">
    <!-- HOME -->
    <section id="home" class="view" aria-label="Home view">
      <div class="hero">
        <div>
          <div style="text-align: center; margin-bottom: 32px;">
            <img src="assets/LOGO with Text.png" alt="COTS Architect" style="max-width: 400px; height: auto; filter: drop-shadow(0 4px 12px rgba(102, 126, 234, 0.3));">
          </div>
          <p class="eyebrow">Offline Mission Planning Tool</p>
          <h1>Design. Validate. Deploy.</h1>
          <p class="lead">Build custom sUAS platforms, plan multi-day missions with logistics, and validate RF communications ‚Äî entirely offline, entirely in your browser. No cloud, no APIs, no internet required.</p>
          <div class="hero-actions">
            <a class="btn primary" href="#/library">Start with Parts Library</a>
            <button class="btn ghost" id="loadSampleMission">Load Sample Mission</button>
          </div>
          <div id="desktopDownloadCTA" class="web-only" style="margin-top: 16px; padding: 16px; background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border: 2px solid #667eea; border-radius: 8px; text-align: center;">
            <p style="margin: 0 0 12px 0; font-weight: 600; color: var(--accent);">
              üíª Looking for the Production Desktop App?
            </p>
            <p class="small" style="margin: 0 0 12px 0;">
              This online demo requires internet. For air-gapped operation with auto-save sessions, build the desktop installer.
            </p>
            <a class="btn primary" href="https://github.com/nbschultz97/Ceradon-Architect#desktop-app-windows" target="_blank" style="text-decoration: none;">
              üì• Get Desktop Version (Windows)
            </a>
          </div>
          <p class="small muted">All data stays local. Export mission packages as JSON. Works in air-gapped environments.</p>
        </div>
      </div>

      <div class="modules-workflows" aria-label="Workflow overview">
        <div class="mw-card">
          <h3>Complete Offline Workflow</h3>
          <p class="small muted">Five integrated modules, one mission package.</p>
          <ul class="bullet-list modules-list">
            <li><strong>Parts Library:</strong> Manage COTS component catalogs. Import inventory from CSV, search 1000+ parts, track availability and specs.</li>
            <li><strong>Platform Designer:</strong> Build virtual platforms from components. Real-time physics validation with environmental derating for altitude, temperature, and weather.</li>
            <li><strong>Mission Planner:</strong> Define mission phases, calculate battery swaps, generate per-operator packing lists with terrain-adjusted weight limits.</li>
            <li><strong>Comms Validator:</strong> Analyze RF link budgets, check line-of-sight, recommend relay placement for coverage gaps.</li>
            <li><strong>üó∫Ô∏è Map & Environment:</strong> Select mission locations on interactive map. Auto-populate coordinates, elevation, and query historical weather data for accurate physics calculations.</li>
          </ul>
        </div>
        <div class="mw-card">
          <h3>Typical Workflow</h3>
          <p class="small muted">Follow this path or jump to any module.</p>
          <ul class="bullet-list">
            <li><strong>Step 1:</strong> Load your unit's inventory into Parts Library (or use sample catalog).</li>
            <li><strong>Step 2:</strong> üó∫Ô∏è Select mission location on Map ‚Äî auto-populates coordinates, elevation, and environmental data.</li>
            <li><strong>Step 3:</strong> Design platforms in Platform Designer ‚Äî select components, validate physics with environmental derating.</li>
            <li><strong>Step 4:</strong> Plan your mission ‚Äî define phases, calculate logistics with battery derating, generate packing lists.</li>
            <li><strong>Step 5:</strong> Validate comms ‚Äî check link budgets, identify coverage gaps, place relays.</li>
            <li><strong>Step 6:</strong> Export complete mission package as JSON for field deployment.</li>
          </ul>
          <p class="small muted">All modules read/write the same MissionProject JSON. Start anywhere, work in any order.</p>
        </div>
      </div>

      <div class="missionproject-callout" aria-label="Quick start guide">
        <h3>Quick Start</h3>
        <div class="quick-start-steps">
          <div class="qs-step">
            <strong>1. Parts Library</strong>
            <p class="small">Load COTS components or import your unit's inventory from CSV.</p>
            <a class="btn subtle" href="#/library">Open Parts Library ‚Üí</a>
          </div>
          <div class="qs-step">
            <strong>2. Platform Designer</strong>
            <p class="small">Build platforms from parts, validate thrust-to-weight and flight time.</p>
            <a class="btn subtle" href="#/platform">Design Platform ‚Üí</a>
          </div>
          <div class="qs-step">
            <strong>3. Mission Planner</strong>
            <p class="small">Define phases, calculate battery swaps, generate packing lists.</p>
            <a class="btn subtle" href="#/mission">Plan Mission ‚Üí</a>
          </div>
          <div class="qs-step">
            <strong>4. Comms Validator</strong>
            <p class="small">Check RF link budgets, validate line-of-sight, place relays.</p>
            <a class="btn subtle" href="#/comms">Validate Comms ‚Üí</a>
          </div>
          <div class="qs-step">
            <strong>5. Export</strong>
            <p class="small">Download complete mission package as JSON for field deployment.</p>
            <a class="btn subtle" href="#/export">Export Package ‚Üí</a>
          </div>
        </div>
      </div>


      <div class="missionproject-status" id="missionProjectStatusPanel" aria-live="polite">
        <div class="status-body">
          <p class="eyebrow">Current Project Status</p>
          <h3 id="statusProjectName">No project loaded</h3>
          <p class="small" id="statusProjectMeta">Load a sample project or import your own to get started.</p>
          <div class="status-meta-grid">
            <div>
              <p class="small muted">Schema</p>
              <strong id="statusSchemaVersion">v2.0.0</strong>
            </div>
            <div>
              <p class="small muted">Source</p>
              <strong id="statusProjectSource">Not loaded</strong>
            </div>
            <div>
              <p class="small muted">Last updated</p>
              <strong id="statusLastUpdated">Not set</strong>
            </div>
          </div>
        </div>
        <div class="status-actions" id="statusActions">
          <button class="btn primary" id="homeLoadDemo" data-default-label="Load sample project">Load sample project</button>
          <button class="btn ghost" id="homeImportProject">Import JSON</button>
          <button class="btn subtle" id="homeClearProject">Clear</button>
          <input type="file" id="homeImportProjectFile" accept="application/json" hidden>
        </div>
      </div>
    </section>

    <!-- PARTS LIBRARY -->
    <section id="library" class="view" aria-label="Parts Library" hidden>
      <div class="section-header">
        <p class="eyebrow">Module 1</p>
        <h2>Parts Library</h2>
        <p class="lead">Manage your COTS component catalog. Import unit inventory from CSV, search and filter parts, track availability and specifications.</p>
      </div>

      <div class="tool-panel">
        <div class="card">
          <h3>Import / Export</h3>
          <div id="csvDropZone" style="border: 2px dashed #667eea; border-radius: 8px; padding: 24px; text-align: center; margin-bottom: 16px; cursor: pointer; transition: all 0.3s; background: rgba(102, 126, 234, 0.05);">
            <p style="font-size: 36px; margin: 0;">üìÅ</p>
            <p style="margin: 8px 0;"><strong>Drag & Drop CSV or Excel File Here</strong></p>
            <p class="small muted">Supports .csv, .xlsx, .xls formats</p>
          </div>
          <div class="action-row">
            <button class="btn primary" id="importCSV">üì• Import CSV/Excel</button>
            <button class="btn ghost" id="loadSampleParts">Load Sample Catalog</button>
            <button class="btn subtle" id="exportPartsJSON">Export as JSON</button>
            <button class="btn ghost" id="downloadCSVTemplate" style="margin-left: auto;">üìÑ Download Template</button>
            <input type="file" id="csvFileInput" accept=".csv,.xlsx,.xls" hidden>
          </div>
          <p class="small muted" style="margin-top: 12px;">
            <strong>üí° Tip:</strong> Import your entire unit inventory from ONE file (CSV or Excel)! Add a "category" column (airframe, motor, battery, esc, radio, etc.) and the system automatically distributes parts.
            <a href="docs/MULTI_SHEET_IMPORT_GUIDE.md" target="_blank" style="color: #667eea; text-decoration: underline;">Import Guide</a>
          </p>
          <p class="small muted" id="partsLibraryStatus">No parts loaded. Import a CSV or load sample catalog.</p>
        </div>

        <div class="card">
          <h3>Search & Filter</h3>
          <div class="form-grid">
            <label>Search parts
              <input type="text" id="partsSearch" placeholder="Search by name, manufacturer, or specs...">
            </label>
            <label>Category
              <select id="partsCategoryFilter">
                <option value="all">All Categories</option>
                <option value="airframes">Airframes</option>
                <option value="motors">Motors</option>
                <option value="escs">ESCs</option>
                <option value="batteries">Batteries</option>
                <option value="flight_controllers">Flight Controllers</option>
                <option value="radios">Radios</option>
                <option value="sensors">Sensors</option>
                <option value="accessories">Accessories</option>
              </select>
            </label>
          </div>
        </div>

        <div class="card">
          <h3>Parts Catalog</h3>
          <div style="margin-bottom: 16px;">
            <input type="text" id="partsSearchInput" placeholder="üîç Search parts by name, manufacturer, or category..." style="width: 100%; margin-bottom: 12px;">
            <div class="form-grid" style="margin-bottom: 12px;">
              <label>Filter by Category
                <select id="partsCategoryFilter">
                  <option value="">All Categories</option>
                  <option value="airframes">Airframes</option>
                  <option value="motors">Motors</option>
                  <option value="escs">ESCs</option>
                  <option value="batteries">Batteries</option>
                  <option value="flight_controllers">Flight Controllers</option>
                  <option value="radios">Radios</option>
                  <option value="sensors">Sensors</option>
                  <option value="accessories">Accessories</option>
                </select>
              </label>
              <label>Sort By
                <select id="partsSortBy">
                  <option value="name">Name (A-Z)</option>
                  <option value="weight">Weight (Low-High)</option>
                  <option value="cost">Cost (Low-High)</option>
                  <option value="quantity">Quantity (High-Low)</option>
                </select>
              </label>
            </div>
          </div>
          <div class="action-row" style="margin-bottom: 16px;">
            <button class="btn primary" id="addNewPart">‚ûï Add New Part</button>
            <button class="btn danger" id="deleteEntireInventory">üóëÔ∏è Delete Entire Inventory</button>
          </div>
          <div id="partsGrid" class="parts-grid">
            <p class="small muted">No parts to display. Import or load sample catalog.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- PART EDITOR MODAL -->
    <div id="partEditorModal" class="modal" hidden>
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h3 id="partEditorTitle">Edit Part</h3>
          <button class="btn subtle" id="closePartEditor" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body">
          <form id="partEditorForm">
            <input type="hidden" id="editPartId">
            <input type="hidden" id="editPartCategory">

            <div class="form-grid">
              <label>Part Name <span style="color: #e53e3e;">*</span>
                <input type="text" id="editPartName" placeholder="e.g., 2207 1750KV Motor" required>
              </label>
              <label>Category <span style="color: #e53e3e;">*</span>
                <select id="editPartCategorySelect" required>
                  <option value="airframes">Airframe</option>
                  <option value="motors">Motor</option>
                  <option value="escs">ESC</option>
                  <option value="batteries">Battery</option>
                  <option value="flight_controllers">Flight Controller</option>
                  <option value="radios">Radio</option>
                  <option value="sensors">Sensor</option>
                  <option value="accessories">Accessory</option>
                </select>
              </label>
            </div>

            <div class="form-grid">
              <label>Manufacturer
                <input type="text" id="editPartManufacturer" placeholder="e.g., T-Motor">
              </label>
              <label>Part Number
                <input type="text" id="editPartNumber" placeholder="e.g., F60-PRO-IV">
              </label>
            </div>

            <div class="form-grid">
              <label>Quantity
                <input type="number" id="editPartQuantity" placeholder="e.g., 8" min="0">
              </label>
              <label>Weight (grams)
                <input type="number" id="editPartWeight" placeholder="e.g., 31.5" step="0.1" min="0">
              </label>
            </div>

            <div class="form-grid">
              <label>Cost (USD)
                <input type="number" id="editPartCost" placeholder="e.g., 25.99" step="0.01" min="0">
              </label>
              <label>Availability
                <select id="editPartAvailability">
                  <option value="">Not specified</option>
                  <option value="in-stock">In Stock</option>
                  <option value="on-order">On Order</option>
                  <option value="unavailable">Unavailable</option>
                  <option value="discontinued">Discontinued</option>
                </select>
              </label>
            </div>

            <label>Product Link
              <input type="url" id="editPartLink" placeholder="https://...">
            </label>

            <div class="action-row" style="margin-bottom: 12px;">
              <button type="button" class="btn ghost" id="autoFillFromLink">üîç Auto-Fill from Link</button>
              <span class="small muted" style="margin-left: auto;">Scrapes product page for specs</span>
            </div>

            <label>Notes
              <textarea id="editPartNotes" rows="3" placeholder="Additional notes or specifications..."></textarea>
            </label>

            <!-- Category-specific fields (shown conditionally) -->
            <div id="categorySpecificFields"></div>

          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn danger" id="deletePartBtn" style="margin-right: auto;">üóëÔ∏è Delete Part</button>
          <button type="button" class="btn ghost" id="cancelPartEdit">Cancel</button>
          <button type="submit" form="partEditorForm" class="btn primary" id="savePartBtn">Save Changes</button>
        </div>
      </div>
    </div>

    <!-- PLATFORM DESIGNER -->
    <section id="platform" class="view" aria-label="Platform Designer" hidden>
      <div class="section-header">
        <p class="eyebrow">Module 2</p>
        <h2>Platform Designer</h2>
        <p class="lead">Build virtual UxS platforms from components. Real-time physics validation with environmental derating.</p>
      </div>

      <div class="tool-panel">
        <div class="card">
          <h3>Platform Configuration</h3>
          <div class="form-grid">
            <label>Platform Name
              <input type="text" id="platformName" placeholder="e.g., Long-Range Recon Quad">
            </label>
            <label>Platform Type
              <select id="platformType">
                <option value="multi-rotor">Multi-rotor</option>
                <option value="fixed-wing">Fixed-wing</option>
                <option value="vtol">VTOL</option>
              </select>
            </label>
          </div>
        </div>

        <div class="card">
          <h3>Environment</h3>
          <p class="small muted" style="margin-bottom: 12px;">
            üí° <strong>Tip:</strong> Use the <a href="#/map" style="color: #667eea; text-decoration: underline;">Map & Environment module</a> to auto-populate elevation and get temperature suggestions based on your mission location.
          </p>
          <div class="form-grid">
            <label>Altitude (m)
              <input type="number" id="envAltitude" value="0" min="0" max="5000" step="100">
            </label>
            <label>Temperature (¬∞C)
              <input type="number" id="envTemperature" value="20" min="-40" max="50" step="5">
            </label>
          </div>
        </div>

        <div class="card">
          <h3>Component Selection</h3>
          <p class="small muted">Select components from your Parts Library</p>
          <div id="componentSelection"></div>
        </div>

        <div class="card">
          <h3>Platform Visualization</h3>
          <p class="small muted">Visual representation of selected components</p>
          <div id="platformVisualization" class="platform-viz">
            <div class="viz-container">
              <div class="viz-layer viz-airframe" id="vizAirframe" title="Airframe"></div>
              <div class="viz-layer viz-motors" id="vizMotors" title="Motors"></div>
              <div class="viz-layer viz-battery" id="vizBattery" title="Battery"></div>
              <div class="viz-layer viz-fc" id="vizFC" title="Flight Controller"></div>
              <div class="viz-layer viz-radio" id="vizRadio" title="Radio"></div>
              <div class="viz-layer viz-sensors" id="vizSensors" title="Sensors"></div>
            </div>
            <div class="viz-legend">
              <div class="legend-item"><span class="legend-dot airframe"></span> Airframe</div>
              <div class="legend-item"><span class="legend-dot motors"></span> Motors</div>
              <div class="legend-item"><span class="legend-dot battery"></span> Battery</div>
              <div class="legend-item"><span class="legend-dot fc"></span> Flight Controller</div>
              <div class="legend-item"><span class="legend-dot radio"></span> Radio</div>
              <div class="legend-item"><span class="legend-dot sensors"></span> Sensors</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Physics Validation</h3>
          <div id="validationResults"></div>
          <div class="action-row">
            <button class="btn primary" id="validatePlatform">Validate Design</button>
            <button class="btn ghost" id="savePlatform">Save Platform</button>
            <button class="btn ghost" id="clearPlatform">Clear Design</button>
            <button class="btn primary" id="autoBuildPlatform">ü§ñ Auto-Build from Inventory</button>
          </div>
        </div>

        <div class="card">
          <h3>Saved Platforms</h3>
          <p class="small muted">Load previously saved platform designs</p>
          <div id="savedPlatformsList" style="margin-top: 12px;"></div>
          <div class="action-row" style="margin-top: 12px;">
            <button class="btn ghost" id="exportPlatformPDF">üìÑ Export PDF</button>
            <button class="btn ghost" id="exportPlatformExcel">üìä Export Excel</button>
            <button class="btn ghost" id="comparePlatforms">‚öñÔ∏è Compare Designs</button>
          </div>
        </div>

        <!-- Module Navigation -->
        <div class="card" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border-left: 4px solid #667eea;">
          <h3>Next Step</h3>
          <p class="small">Ready to plan a mission with this platform?</p>
          <div class="action-row" style="margin-top: 12px;">
            <button class="btn ghost" onclick="window.location.hash = '#/map'">‚Üê Map & Environment</button>
            <button class="btn primary" onclick="window.location.hash = '#/mission'">Mission Planner ‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <!-- MISSION PLANNER -->
    <section id="mission" class="view" aria-label="Mission Planner" hidden>
      <div class="section-header">
        <p class="eyebrow">Module 3</p>
        <h2>Mission Planner</h2>
        <p class="lead">Define mission phases, calculate battery swaps, generate per-operator packing lists with terrain-adjusted weight limits.</p>
      </div>

      <div class="tool-panel">
        <div class="card" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border-left: 4px solid #667eea;">
          <h3>üó∫Ô∏è Mission Environment Setup</h3>
          <p class="small" style="margin-bottom: 12px;">Before planning logistics, select your mission location and query environmental data for accurate physics calculations.</p>
          <div class="action-row">
            <a href="#/map" class="btn primary">
              üìç Select Location on Map
            </a>
            <button class="btn ghost" onclick="alert('First select a location on the Map, then query environmental data for temperature/wind suggestions.')">
              ‚ÑπÔ∏è How It Works
            </button>
          </div>
          <p class="small muted" style="margin-top: 12px;">
            The map will auto-populate coordinates and elevation. Environmental data will suggest temperature and wind for battery derating calculations.
          </p>
        </div>

        <div class="card">
          <h3>Mission Details</h3>
          <div class="form-grid">
            <label>Mission Name
              <input type="text" id="missionName" placeholder="e.g., Ridge Reconnaissance - 48hr">
            </label>
            <label>Duration (hours)
              <input type="number" id="missionDuration" value="48" min="1" max="168" step="1">
            </label>
            <label>Terrain
              <select id="missionTerrain">
                <option value="urban">Urban</option>
                <option value="suburban">Suburban</option>
                <option value="rural">Rural</option>
                <option value="mountain">Mountain</option>
                <option value="desert">Desert</option>
              </select>
            </label>
            <label>Team Size
              <input type="number" id="teamSize" value="4" min="1" max="12" step="1">
            </label>
          </div>
        </div>

        <div class="card" id="missionEnvDataCard" style="display: none;">
          <h3>üìä Environmental Data</h3>
          <div id="missionEnvDataDisplay">
            <p class="small muted">No environmental data loaded. Visit Map & Environment to select location and query data.</p>
          </div>
        </div>

        <div class="card">
          <h3>Mission Phases</h3>
          <div id="phasesEditor"></div>
          <button class="btn subtle" id="addPhase">+ Add Phase</button>
        </div>

        <div class="card">
          <h3>Logistics Calculation</h3>
          <div id="logisticsResults"></div>
          <div class="action-row">
            <button class="btn primary" id="calculateLogistics">Calculate Logistics</button>
            <button class="btn ghost" id="downloadPackingLists">Download Packing Lists</button>
          </div>
        </div>

        <!-- Module Navigation -->
        <div class="card" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border-left: 4px solid #667eea;">
          <h3>Next Step</h3>
          <p class="small">Ready to validate RF communications for this mission?</p>
          <div class="action-row" style="margin-top: 12px;">
            <button class="btn ghost" onclick="window.location.hash = '#/platform'">‚Üê Platform Designer</button>
            <button class="btn primary" onclick="window.location.hash = '#/comms'">Comms Validator ‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <!-- COMMS VALIDATOR -->
    <section id="comms" class="view" aria-label="Comms Validator" hidden>
      <div class="section-header">
        <p class="eyebrow">Module 4</p>
        <h2>Comms Validator</h2>
        <p class="lead">Analyze RF link budgets, check line-of-sight, recommend relay placement for coverage gaps.</p>
      </div>

      <div class="tool-panel">
        <div class="card">
          <h3>Environment</h3>
          <div class="form-grid">
            <label>Terrain Type
              <select id="commsTerrain">
                <option value="open">Open</option>
                <option value="rural">Rural</option>
                <option value="suburban">Suburban</option>
                <option value="urban">Urban</option>
                <option value="dense_urban">Dense Urban</option>
              </select>
            </label>
            <label>Weather Conditions
              <select id="commsWeather">
                <option value="clear">Clear</option>
                <option value="light_rain">Light Rain</option>
                <option value="heavy_rain">Heavy Rain</option>
                <option value="snow">Snow</option>
                <option value="fog">Fog</option>
              </select>
            </label>
          </div>
        </div>

        <div class="card">
          <h3>Node Placement Map</h3>
          <p class="small muted">Click on the map to place nodes (GCS, UAV, Relay). Map shows actual terrain basemap.</p>
          <div id="commsMapLeaflet" style="height: 400px; width: 100%; margin-top: 12px; border-radius: 8px; overflow: hidden; z-index: 1;"></div>
          <div style="margin-top: 12px; padding: 8px; background: var(--panel); border-radius: 4px; font-size: 11px; display: flex; gap: 16px;">
            <div style="color: #4ade80;">üü¢ GCS (Ground Control Station)</div>
            <div style="color: #60a5fa;">üîµ UAV (Unmanned Aerial Vehicle)</div>
            <div style="color: #fbbf24;">üü° Relay (Communication Relay)</div>
          </div>
          <div class="action-row" style="margin-top: 12px;">
            <button class="btn subtle" id="addNodeManual">‚ûï Add Node Manually</button>
            <button class="btn ghost" id="clearNodes">Clear All Nodes</button>
          </div>
        </div>

        <div class="card">
          <h3>Nodes</h3>
          <div id="nodesEditor"></div>
        </div>

        <div class="card">
          <h3>Link Analysis</h3>
          <div id="linkAnalysisResults"></div>
          <div class="action-row">
            <button class="btn primary" id="analyzeLinks">Analyze Links</button>
            <button class="btn ghost" id="downloadCommsReport">Download Report</button>
          </div>
        </div>

        <!-- Module Navigation -->
        <div class="card" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border-left: 4px solid #667eea;">
          <h3>Next Step</h3>
          <p class="small">Ready to export your complete mission package?</p>
          <div class="action-row" style="margin-top: 12px;">
            <button class="btn ghost" onclick="window.location.hash = '#/mission'">‚Üê Mission Planner</button>
            <button class="btn primary" onclick="window.location.hash = '#/export'">Export Package ‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <!-- MAP VIEWER -->
    <section id="map" class="view" aria-label="Map Viewer" hidden>
      <div class="section-header">
        <p class="eyebrow">Offline GIS</p>
        <h2>Map & Environmental Intelligence</h2>
        <p class="lead">Select mission locations on the map. Automatically populate coordinates, elevation, and historical environmental data.</p>
      </div>

      <div class="tool-panel">
        <div class="card">
          <h3>Mission Location Picker</h3>
          <p class="small muted">Click on the map to select a location. Lat/lon and elevation will auto-populate from terrain data.</p>
          <div id="mapContainer" style="height: 500px; width: 100%; margin-top: 12px; border-radius: 8px; overflow: hidden;"></div>
        </div>

        <div class="card">
          <h3>Selected Location</h3>
          <div id="selectedLocationInfo">
            <p class="small muted">No location selected. Click on the map to select.</p>
          </div>
        </div>

        <div class="card">
          <h3>Environmental Intelligence</h3>
          <p class="small muted">Query historical weather averages for your mission timeframe. This data auto-suggests temperature and wind for physics calculations.</p>
          <div class="form-grid">
            <label>Query Type
              <select id="envQueryType">
                <option value="single">Single Date</option>
                <option value="range">Date Range (Multi-Day Mission)</option>
              </select>
            </label>
          </div>
          <div id="singleDateInput" class="form-grid" style="margin-top: 12px;">
            <label>Mission Date (for seasonal averages)
              <input type="date" id="missionDate" />
            </label>
          </div>
          <div id="dateRangeInputs" class="form-grid" style="margin-top: 12px; display: none;">
            <label>Start Date
              <input type="date" id="missionStartDate" />
            </label>
            <label>End Date
              <input type="date" id="missionEndDate" />
            </label>
          </div>
          <button class="btn primary" id="getEnvironmentalData" style="margin-top: 12px; width: 100%;">
            üìä Query Environmental Data
          </button>
          <div id="environmentalDataDisplay"></div>
          <p class="small muted" style="margin-top: 12px;">
            üí° <strong>Tip:</strong> The system uses historical monthly averages. For date ranges, you'll get data for each month covered.
          </p>
        </div>

        <div class="card">
          <h3>SRTM Elevation Data</h3>
          <p class="small muted">Upload offline elevation tiles for terrain-aware planning. Supports SRTM1 (30m) and SRTM3 (90m) .hgt files.</p>
          <div class="action-row">
            <button class="btn primary" id="uploadSRTMTile">Upload SRTM Tile (.hgt)</button>
            <button class="btn subtle" id="listSRTMTiles">List Loaded Tiles</button>
            <input type="file" id="srtmFileInput" accept=".hgt,.HGT" hidden>
          </div>
          <div id="srtmTilesList" style="margin-top: 12px;"></div>
        </div>

        <!-- Module Navigation -->
        <div class="card" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border-left: 4px solid #667eea;">
          <h3>Next Step</h3>
          <p class="small">Ready to design your platform with this environmental data?</p>
          <div class="action-row" style="margin-top: 12px;">
            <button class="btn ghost" onclick="window.location.hash = '#/library'">‚Üê Parts Library</button>
            <button class="btn primary" onclick="window.location.hash = '#/platform'">Platform Designer ‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <!-- EXPORT -->
    <section id="export" class="view" aria-label="Export" hidden>
      <div class="section-header">
        <p class="eyebrow">Mission Package</p>
        <h2>Export Mission Package</h2>
        <p class="lead">Download your complete mission package as JSON, GeoJSON, or CoT for field deployment.</p>
      </div>

      <div class="tool-panel">
        <div class="card">
          <h3>Current Mission Project</h3>
          <div id="exportSummary"></div>
        </div>

        <div class="card">
          <h3>Export Options</h3>
          <div class="action-row">
            <button class="btn primary" id="exportMissionJSON">Export MissionProject JSON</button>
            <button class="btn ghost" id="exportGeoJSON">Export GeoJSON</button>
            <button class="btn subtle" id="exportCoT">Export CoT Stub</button>
          </div>
        </div>

        <div class="card">
          <h3>Doctrinal Reporting</h3>
          <p class="small muted">Generate standard military reports derived from mission data. Pre-filled with platform, location, and team information for rapid tactical reporting.</p>
          <div class="action-row">
            <button class="btn primary btn-icon" id="exportSpotReport">üìç Export Spot Report</button>
            <button class="btn ghost btn-icon" id="exportSALUTEReport">üìä Export SALUTE Report</button>
            <button class="btn subtle btn-icon" id="export16LineReport">üöë Export 16-Line Report</button>
          </div>
        </div>

        <div class="card">
          <h3>Mission Cards</h3>
          <p class="small muted">Generate printable mission cards with phase details, timings, and equipment requirements. Perfect for field operations.</p>
          <div class="action-row">
            <button class="btn primary btn-icon" id="exportMissionCardsPDF">üìÑ Export as PDF</button>
            <button class="btn ghost btn-icon" id="printMissionCards">üñ®Ô∏è Print Cards</button>
            <button class="btn subtle btn-icon" id="exportMissionCardsJSON">üíæ Export as JSON</button>
          </div>
        </div>

        <div class="card">
          <h3>Mission Project Viewer</h3>
          <textarea id="jsonViewer" class="json-editor" rows="20" readonly></textarea>
        </div>
      </div>
    </section>
  </main>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" hidden>
    <div class="modal-content" style="max-width: 700px; max-height: 85vh; overflow-y: auto;">
      <div class="modal-header">
        <h2 style="margin: 0;">‚öôÔ∏è Settings</h2>
        <button class="modal-close" id="closeSettings" aria-label="Close settings">√ó</button>
      </div>
      <div class="modal-body">
        <!-- Units Section -->
        <div class="card">
          <h3>Units & Measurements</h3>
          <div class="form-group">
            <label for="settingsDistanceUnit">Distance</label>
            <select id="settingsDistanceUnit" class="form-control">
              <option value="metric">Metric (meters, kilometers)</option>
              <option value="imperial">Imperial (feet, miles)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="settingsWeightUnit">Weight</label>
            <select id="settingsWeightUnit" class="form-control">
              <option value="metric">Metric (grams, kilograms)</option>
              <option value="imperial">Imperial (ounces, pounds)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="settingsTemperatureUnit">Temperature</label>
            <select id="settingsTemperatureUnit" class="form-control">
              <option value="celsius">Celsius (¬∞C)</option>
              <option value="fahrenheit">Fahrenheit (¬∞F)</option>
            </select>
          </div>
        </div>

        <!-- Map Section -->
        <div class="card">
          <h3>Map Settings</h3>
          <div class="form-group">
            <label for="settingsTileProvider">Tile Provider</label>
            <select id="settingsTileProvider" class="form-control">
              <option value="osm">OpenStreetMap (Standard)</option>
              <option value="osm-topo">OpenTopoMap (Topographic)</option>
              <option value="osm-cycle">OpenCycleMap (Terrain)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="settingsDefaultZoom">Default Zoom Level</label>
            <input type="range" id="settingsDefaultZoom" min="1" max="18" value="10" class="form-control">
            <span id="settingsDefaultZoomValue" class="small muted">10</span>
          </div>
        </div>

        <!-- UI Section -->
        <div class="card">
          <h3>User Interface</h3>
          <div class="form-group">
            <label for="settingsTheme">Theme</label>
            <select id="settingsTheme" class="form-control">
              <option value="dark">Dark Mode</option>
              <option value="light">Light Mode</option>
            </select>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="settingsShowTooltips">
              Show tooltips and hints
            </label>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="settingsAutoSave">
              Auto-save projects (desktop app only)
            </label>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="settingsConfirmDelete">
              Confirm before deleting items
            </label>
          </div>
        </div>

        <!-- Data Section -->
        <div class="card">
          <h3>Data Management</h3>
          <div class="form-group">
            <label for="settingsExportFormat">Default Export Format</label>
            <select id="settingsExportFormat" class="form-control">
              <option value="json">JSON (Standard)</option>
              <option value="geojson">GeoJSON (Geographic)</option>
              <option value="cot">Cursor-on-Target (CoT)</option>
            </select>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="settingsAutoCleanup">
              Automatically cleanup old data
            </label>
          </div>
          <div class="action-row" style="margin-top: 16px;">
            <button class="btn subtle" id="settingsExportBtn">Export Settings</button>
            <button class="btn subtle" id="settingsImportBtn">Import Settings</button>
            <input type="file" id="settingsImportInput" accept=".json" hidden>
          </div>
        </div>

        <!-- Advanced Section -->
        <div class="card">
          <h3>Advanced</h3>
          <div class="form-group">
            <label>
              <input type="checkbox" id="settingsDebugMode">
              Debug mode (show detailed console logs)
            </label>
          </div>
          <div class="action-row" style="margin-top: 16px;">
            <button class="btn subtle" id="downloadErrorLog">Download Error Log</button>
            <button class="btn ghost" id="clearErrorLog">Clear Error Log</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn ghost" id="resetSettings">Reset to Defaults</button>
        <button class="btn primary" id="saveSettings">Save Settings</button>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div style="max-width: 1200px; margin: 0 auto; padding: 24px;">
      <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 32px; margin-bottom: 24px;">
        <!-- About -->
        <div>
          <h4 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;">COTS Architect</h4>
          <p style="margin: 0 0 12px 0; font-size: 14px; color: var(--text-muted); line-height: 1.6;">
            Offline-first mission planning for air-gapped, contested environments. Design platforms, plan logistics, validate communications ‚Äî entirely in your browser with zero cloud dependencies.
          </p>
          <div class="footer-meta">
            <span data-app-version></span>
            <span class="divider">‚Ä¢</span>
            <span data-schema-version></span>
          </div>
        </div>

        <!-- Links -->
        <div>
          <h4 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;">Resources</h4>
          <ul style="list-style: none; padding: 0; margin: 0; font-size: 14px;">
            <li style="margin-bottom: 8px;">
              <a href="https://github.com/nbschultz97/Ceradon-Architect" target="_blank" style="color: var(--text-muted); text-decoration: none;">GitHub Repository</a>
            </li>
            <li style="margin-bottom: 8px;">
              <a href="https://github.com/nbschultz97/Ceradon-Architect/blob/main/CHANGELOG.md" target="_blank" style="color: var(--text-muted); text-decoration: none;">üìã Changelog & Updates</a>
            </li>
            <li style="margin-bottom: 8px;">
              <a href="https://github.com/nbschultz97/Ceradon-Architect/blob/main/docs/v0.3_offline_gis_almanac.md" target="_blank" style="color: var(--text-muted); text-decoration: none;">Documentation</a>
            </li>
            <li style="margin-bottom: 8px;">
              <a href="https://github.com/nbschultz97/Ceradon-Architect/blob/main/SECURITY_AUDIT_v0.3.md" target="_blank" style="color: var(--text-muted); text-decoration: none;">Security Audit</a>
            </li>
            <li style="margin-bottom: 8px;">
              <a href="https://github.com/nbschultz97/Ceradon-Architect/issues" target="_blank" style="color: var(--text-muted); text-decoration: none;">Report Issues</a>
            </li>
          </ul>
        </div>

        <!-- Maintainer -->
        <div>
          <h4 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;">Maintainer</h4>
          <ul style="list-style: none; padding: 0; margin: 0; font-size: 14px;">
            <li style="margin-bottom: 8px;">
              <span style="color: var(--text-muted);">üë§ Noah Schultz (individual)</span>
            </li>
            <li style="margin-bottom: 8px;">
              <a href="https://github.com/nbschultz97" target="_blank" style="color: var(--text-muted); text-decoration: none;">GitHub Profile</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Disclaimer -->
      <div id="offline-notice" style="border-top: 1px solid var(--border); padding-top: 20px; margin-top: 20px;">
        <p style="margin: 0 0 12px 0; font-size: 14px; color: #ff9800; font-weight: 600; line-height: 1.6;">
          ‚ö†Ô∏è <strong>ONLINE DEMONSTRATION ONLY - NOT FOR PRODUCTION USE</strong>
        </p>
        <p style="margin: 0 0 12px 0; font-size: 13px; color: var(--text-muted); line-height: 1.6;">
          This GitHub Pages site is for <strong>evaluation and testing only</strong>. For production use, download and install the desktop application which provides full offline operation with zero internet dependencies. Do not use this online demo for operational planning or sensitive data.
        </p>
        <p style="margin: 0 0 12px 0; font-size: 13px; color: var(--text-muted); line-height: 1.6;">
          <strong>Production Deployment:</strong> Build the Windows desktop installer with <code>npm run desktop:dist</code>. The desktop app auto-saves sessions locally and works completely air-gapped. See README for deployment instructions.
        </p>
        <p style="margin: 0; font-size: 12px; color: var(--text-muted); line-height: 1.6;">
          Maintained by Noah Schultz (individual). Open-source mission planning tool. Not affiliated with or endorsed by DoD/USG.
        </p>
      </div>
    </div>
  </footer>

  <!-- Load Leaflet library (offline mapping) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

  <!-- Load SheetJS library for Excel import/export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

  <!-- Load jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Load event bus, error handler, settings, and UI feedback first -->
  <script src="assets/js/mission_project_events.js"></script>
  <script src="assets/js/error_handler.js"></script>
  <script src="assets/js/settings_manager.js"></script>
  <script src="assets/js/ui_feedback.js"></script>
  <script src="assets/js/workflow_progress.js"></script>

  <!-- Load offline modules -->
  <script src="assets/js/parts_library.js"></script>
  <script src="assets/js/physics_engine.js"></script>
  <script src="assets/js/platform_viz.js"></script>
  <script src="assets/js/platform_designer.js"></script>
  <script src="assets/js/mission_planner.js"></script>
  <script src="assets/js/comms_validator.js"></script>
  <script src="assets/js/csv_importer.js"></script>
  <script src="assets/js/mission_cards.js"></script>
  <script src="assets/js/undo_redo.js"></script>

  <!-- GIS and Environmental Intelligence modules -->
  <script src="assets/js/srtm_fallback.js"></script>
  <script src="assets/js/srtm_elevation.js"></script>
  <script src="assets/js/environment_almanac.js"></script>
  <script src="assets/js/map_viewer.js"></script>

  <!-- Then load MissionProject store and main app -->
  <script src="assets/js/mission_project.js"></script>
  <script src="assets/js/desktop_session.js"></script>
  <script src="assets/js/settings_ui.js"></script>
  <script src="assets/js/app.js"></script>
</body>
</html>
